<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOM Prayer Times - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0a2f35 0%, #1a1a1a 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* Login Screen */
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        .login-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
        }

        .login-container h1 {
            color: #0a2f35;
            margin-bottom: 10px;
            font-size: 24px;
        }

        .login-container p {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .pin-input {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            text-align: center;
            letter-spacing: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: monospace;
        }

        .pin-input:focus {
            outline: none;
            border-color: #00ff88;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: #00ff88;
            color: #0a2f35;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            background: #00dd77;
            transform: translateY(-2px);
        }

        .error-message {
            color: #dc3545;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Main Admin Panel */
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            display: none;
        }

        .container.show {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .app-icon {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            display: block;
        }

        h1 {
            color: #0a2f35;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .prayer-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .prayer-section:hover {
            border-color: #00ff88;
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.1);
        }

        .prayer-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .prayer-name {
            font-size: 20px;
            font-weight: 600;
            color: #0a2f35;
        }

        .prayer-name-ar {
            font-size: 18px;
            color: #00ff88;
            font-weight: 500;
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .input-group input {
            padding: 12px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            text-align: center;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: #00ff88;
            color: #0a2f35;
        }

        .btn-primary:hover {
            background: #00dd77;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            display: none;
        }

        .status.show {
            display: block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .last-updated {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        @media (max-width: 600px) {
            .time-inputs {
                grid-template-columns: 1fr;
            }

            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <img src="data:image/png;base64,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" 
             alt="IOM Prayer Times" 
             class="login-icon">
        <h1>Admin Panel</h1>
        <p>Isle of Man Islamic Association</p>
        <input type="password" 
               class="pin-input" 
               id="pinInput" 
               placeholder="******" 
               maxlength="6"
               autocomplete="off">
        <button class="login-btn" onclick="checkPin()">Enter</button>
        <div class="error-message" id="errorMessage">Incorrect PIN. Please try again.</div>
    </div>

    <!-- Admin Panel -->
    <div class="container" id="adminPanel">
        <button class="logout-btn" onclick="logout()">Logout</button>
        
        <div class="header">
            <img src="data:image/png;base64,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" 
                 alt="IOM Prayer Times" 
                 class="app-icon">
            <h1>Prayer Times Manager</h1>
            <p class="subtitle">Update Masjid Adhan and Iqama times</p>
        </div>

        <!-- Fajr -->
        <div class="prayer-section">
            <div class="prayer-header">
                <span class="prayer-name">Fajr</span>
                <span class="prayer-name-ar">الفجر</span>
            </div>
            <div class="time-inputs">
                <div class="input-group">
                    <label>Adhan Time</label>
                    <input type="time" id="fajr-adhan" value="06:21">
                </div>
                <div class="input-group">
                    <label>Iqama Time</label>
                    <input type="time" id="fajr-iqama" value="07:00">
                </div>
            </div>
        </div>

        <!-- Dhuhr -->
        <div class="prayer-section">
            <div class="prayer-header">
                <span class="prayer-name">Dhuhr</span>
                <span class="prayer-name-ar">الظهر</span>
            </div>
            <div class="time-inputs">
                <div class="input-group">
                    <label>Adhan Time</label>
                    <input type="time" id="dhuhr-adhan" value="12:30">
                </div>
                <div class="input-group">
                    <label>Iqama Time</label>
                    <input type="time" id="dhuhr-iqama" value="12:45">
                </div>
            </div>
        </div>

        <!-- Asr -->
        <div class="prayer-section">
            <div class="prayer-header">
                <span class="prayer-name">Asr</span>
                <span class="prayer-name-ar">العصر</span>
            </div>
            <div class="time-inputs">
                <div class="input-group">
                    <label>Adhan Time</label>
                    <input type="time" id="asr-adhan" value="14:30">
                </div>
                <div class="input-group">
                    <label>Iqama Time</label>
                    <input type="time" id="asr-iqama" value="14:45">
                </div>
            </div>
        </div>

        <!-- Maghrib -->
        <div class="prayer-section">
            <div class="prayer-header">
                <span class="prayer-name">Maghrib</span>
                <span class="prayer-name-ar">المغرب</span>
            </div>
            <div class="time-inputs">
                <div class="input-group">
                    <label>Adhan Time</label>
                    <input type="time" id="maghrib-adhan" value="16:08">
                </div>
                <div class="input-group">
                    <label>Iqama Time</label>
                    <input type="time" id="maghrib-iqama" value="16:13">
                </div>
            </div>
        </div>

        <!-- Isha -->
        <div class="prayer-section">
            <div class="prayer-header">
                <span class="prayer-name">Isha</span>
                <span class="prayer-name-ar">العشاء</span>
            </div>
            <div class="time-inputs">
                <div class="input-group">
                    <label>Adhan Time</label>
                    <input type="time" id="isha-adhan" value="17:50">
                </div>
                <div class="input-group">
                    <label>Iqama Time</label>
                    <input type="time" id="isha-iqama" value="18:00">
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-secondary" onclick="resetTimes()">Reset</button>
            <button class="btn btn-primary" onclick="saveAndPublish()">Save & Publish to GitHub</button>
        </div>

        <div class="status" id="status"></div>
        
        <div class="last-updated" id="lastUpdated">
            Last updated: Never
        </div>
    </div>

    <script>
        // Obfuscated PIN check
        const _0x4a2b=['763732','value','getElementById','pinInput','classList','add','show','errorMessage','remove','loginScreen','adminPanel'];
        const _0x1c3d=function(_0x2d8f05,_0x4b81bb){_0x2d8f05=_0x2d8f05-0x0;let _0x4d74cb=_0x4a2b[_0x2d8f05];return _0x4d74cb;};
        const correctPin=_0x1c3d('0x0');

        function checkPin() {
            const pin = document[_0x1c3d('0x2')](_0x1c3d('0x3'))[_0x1c3d('0x1')];
            
            if (pin === correctPin) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel')[_0x1c3d('0x4')][_0x1c3d('0x5')](_0x1c3d('0x6'));
                loadCurrentTimes();
            } else {
                document[_0x1c3d('0x2')](_0x1c3d('0x7'))[_0x1c3d('0x4')][_0x1c3d('0x5')](_0x1c3d('0x6'));
                document[_0x1c3d('0x2')](_0x1c3d('0x3'))[_0x1c3d('0x1')] = '';
                setTimeout(() => {
                    document[_0x1c3d('0x2')](_0x1c3d('0x7'))[_0x1c3d('0x4')][_0x1c3d('0x8')](_0x1c3d('0x6'));
                }, 3000);
            }
        }

        function logout() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('adminPanel').classList.remove('show');
            document.getElementById('pinInput').value = '';
        }

        // Allow Enter key to submit PIN
        document.getElementById('pinInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPin();
            }
        });

        async function loadCurrentTimes() {
            try {
                const response = await fetch('https://bodiabdeen.github.io/PT/prayer-times.json');
                const data = await response.json();
                
                data.prayers.forEach(prayer => {
                    const name = prayer.name.toLowerCase();
                    const adhanInput = document.getElementById(`${name}-adhan`);
                    const iqamaInput = document.getElementById(`${name}-iqama`);
                    
                    if (adhanInput) {
                        adhanInput.value = prayer.adhan || '';
                    }
                    if (iqamaInput) {
                        iqamaInput.value = prayer.iqama || '';
                    }
                });
                
                document.getElementById('lastUpdated').textContent = 
                    `Last updated: ${new Date(data.lastUpdated).toLocaleString()}`;
                    
            } catch (error) {
                console.error('Error loading times:', error);
            }
        }

        function resetTimes() {
            if (confirm('Reset all times to default values?')) {
                document.getElementById('fajr-adhan').value = '06:21';
                document.getElementById('fajr-iqama').value = '07:00';
                document.getElementById('dhuhr-adhan').value = '12:30';
                document.getElementById('dhuhr-iqama').value = '12:45';
                document.getElementById('asr-adhan').value = '14:30';
                document.getElementById('asr-iqama').value = '14:45';
                document.getElementById('maghrib-adhan').value = '16:08';
                document.getElementById('maghrib-iqama').value = '16:13';
                document.getElementById('isha-adhan').value = '17:50';
                document.getElementById('isha-iqama').value = '18:00';
            }
        }

        async function saveAndPublish() {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = 'Preparing data...';
            statusDiv.className = 'status show';

            const data = {
                lastUpdated: new Date().toISOString(),
                prayers: [
                    {
                        name: "Fajr",
                        nameAr: "الفجر",
                        adhan: document.getElementById('fajr-adhan').value,
                        iqama: document.getElementById('fajr-iqama').value
                    },
                    {
                        name: "Dhuhr",
                        nameAr: "الظهر",
                        adhan: document.getElementById('dhuhr-adhan').value,
                        iqama: document.getElementById('dhuhr-iqama').value
                    },
                    {
                        name: "Asr",
                        nameAr: "العصر",
                        adhan: document.getElementById('asr-adhan').value,
                        iqama: document.getElementById('asr-iqama').value
                    },
                    {
                        name: "Maghrib",
                        nameAr: "المغرب",
                        adhan: document.getElementById('maghrib-adhan').value,
                        iqama: document.getElementById('maghrib-iqama').value
                    },
                    {
                        name: "Isha",
                        nameAr: "العشاء",
                        adhan: document.getElementById('isha-adhan').value,
                        iqama: document.getElementById('isha-iqama').value
                    }
                ]
            };

            const jsonContent = JSON.stringify(data, null, 2);
            
            // GitHub API configuration
            const GITHUB_TOKEN = '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'; 
            const REPO_OWNER = 'bodiabdeen';
            const REPO_NAME = 'PT';
            const FILE_PATH = 'prayer-times.json';
            
            try {
                statusDiv.textContent = 'Fetching current file...';
                
                // Get current file SHA
                const getResponse = await fetch(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`,
                    {
                        headers: {
                            'Authorization': `Bearer ${GITHUB_TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    }
                );
                
                if (!getResponse.ok) {
                    const errorData = await getResponse.json();
                    throw new Error(`GitHub API Error: ${errorData.message || getResponse.statusText}`);
                }
                
                const currentFile = await getResponse.json();
                
                statusDiv.textContent = 'Publishing to GitHub...';
                
                // Update file
                const updateResponse = await fetch(
                    `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${GITHUB_TOKEN}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update prayer times - ${new Date().toLocaleString()}`,
                            content: btoa(unescape(encodeURIComponent(jsonContent))),
                            sha: currentFile.sha
                        })
                    }
                );
                
                if (updateResponse.ok) {
                    statusDiv.textContent = 'Success! Published to GitHub. All apps will receive updates.';
                    statusDiv.className = 'status success show';
                    
                    document.getElementById('lastUpdated').textContent = 
                        `Last updated: ${new Date().toLocaleString()}`;
                    
                    setTimeout(() => {
                        statusDiv.classList.remove('show');
                    }, 5000);
                } else {
                    const errorData = await updateResponse.json();
                    throw new Error(`Update failed: ${errorData.message || updateResponse.statusText}`);
                }
                
            } catch (error) {
                console.error('Error:', error);
                console.error('Error details:', error.message);
                
                // Try to get more error details
                if (error.response) {
                    const errorText = await error.response.text();
                    console.error('Response error:', errorText);
                }
                
                statusDiv.textContent = `Error: ${error.message}. Check browser console (F12) for details.`;
                statusDiv.className = 'status error show';
            }
        }

        // Auto-focus PIN input on load
        window.onload = function() {
            document.getElementById('pinInput').focus();
        };
    </script>
</body>
</html>
